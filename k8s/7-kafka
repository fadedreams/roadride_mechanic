helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
confluentinc/cp-kafka

eval $(minikube docker-env)
minikube start --memory=7500
kubectl create namespace roadride
kubectl config set-context --current --namespace=roadride

helm install kafka bitnami/kafka \
  -f kafka-values.yaml \
  --namespace roadride

kubectl port-forward svc/kafka 9092:9092 -n roadride &

helm install schema-registry bitnami/schema-registry \
  -f sr-values.yaml \
  --namespace roadride

kubectl port-forward svc/schema-registry 8081:8081 -n roadride &

kubectl apply -f kafka-client.yaml

CLIENT_PASSWORD=$(kubectl get secret kafka-user-passwords --namespace roadride -o jsonpath='{.data.client-passwords}' | base64 -d | cut -d , -f 1)
echo $CLIENT_PASSWORD  # Verify it (e.g., it might be something like "abc123")

client.properties:
security.protocol=SASL_PLAINTEXT
sasl.mechanism=SCRAM-SHA-256
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required username="user1" password="${CLIENT_PASSWORD}";

docker run -it --rm \
  --network minikube \
  -v $(pwd)/client.properties:/tmp/client.properties \
  -e CLIENT_PASSWORD="$CLIENT_PASSWORD" \
  confluentinc/cp-kafka:latest \
  bash
